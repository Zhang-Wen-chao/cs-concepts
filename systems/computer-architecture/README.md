# 计算机体系结构 (Computer Architecture)

> 深入理解计算机硬件的组织方式和工作原理

## 📚 本模块内容

计算机体系结构研究计算机系统的组织方式、设计原理和性能优化。理解体系结构能帮助我们：
- 编写更高效的代码
- 理解程序性能瓶颈
- 做出更好的系统设计决策

## 🏗️ 核心概念

### 1. [计算机组成原理](./computer-organization.md)
> 冯·诺依曼架构与计算机五大组件

**核心内容：**
- 冯·诺依曼架构
- CPU 的组成（控制器、运算器）
- 存储器的层次结构
- 输入/输出系统
- 总线系统

**关键概念：**
- 存储程序原理
- 指令周期
- 数据通路
- 微操作

### 2. [指令集架构 (ISA)](./instruction-set-architecture.md)
> 软件与硬件的接口

**核心内容：**
- CISC vs RISC
- 指令格式与寻址方式
- 寄存器组织
- 汇编语言基础

**关键概念：**
- 指令集设计原则
- 寻址模式
- 指令编码
- 寄存器分配

### 3. [存储层次结构](./memory-hierarchy.md)
> 从寄存器到磁盘的完整层次

**核心内容：**
- 存储器层次：寄存器、Cache、内存、硬盘
- Cache 工作原理
- 虚拟内存
- 局部性原理

**关键概念：**
- Cache 映射（直接映射、组相联、全相联）
- Cache 替换策略（LRU、FIFO）
- 缺页处理
- TLB（Translation Lookaside Buffer）

### 4. [流水线与并行处理](./pipelining-parallelism.md)
> 提升性能的核心技术

**核心内容：**
- 指令流水线
- 流水线冒险（结构冒险、数据冒险、控制冒险）
- 分支预测
- 超标量处理器
- 多核架构

**关键概念：**
- 流水线阶段
- 数据转发（Forwarding）
- 流水线停顿（Stall）
- 乱序执行

### 5. [性能评估](./performance-evaluation.md)
> 如何衡量计算机性能

**核心内容：**
- 性能指标：CPI、吞吐量、延迟
- Amdahl 定律
- 性能测试方法
- 性能优化策略

**关键概念：**
- 加速比
- 并行效率
- 性能瓶颈分析

## 🔗 概念关联图

```
计算机体系结构
│
├─ 硬件层面
│  ├─ 计算机组成原理 → 理解硬件基本结构
│  ├─ 存储层次 → 理解数据存储与访问
│  └─ 流水线 → 理解并行执行机制
│
├─ 软硬件接口
│  └─ 指令集架构 → 连接高级语言与硬件
│
└─ 性能优化
   └─ 性能评估 → 量化与优化系统性能
```

## 🎯 学习路径

### 初学者路径
1. **计算机组成原理** - 建立整体框架
2. **指令集架构** - 理解软硬件接口
3. **存储层次结构** - 掌握数据访问机制
4. **流水线基础** - 了解性能提升原理

### 深入学习路径
1. **Cache 优化** - 深入缓存机制
2. **流水线冒险处理** - 理解流水线细节
3. **并行处理** - 多核与向量化
4. **性能调优** - 实际优化技巧

## 💡 为什么要学习计算机体系结构？

### 编写高性能代码
- 理解 Cache 友好的数据结构设计
- 避免分支预测失败
- 利用指令级并行

### 理解系统行为
- 为什么有些程序运行快，有些慢？
- 内存访问为什么是性能瓶颈？
- 如何利用多核处理器？

### 实际应用案例

**案例 1：循环优化**
```c
// 不友好的 Cache 访问（按列访问）
for (int j = 0; j < N; j++)
    for (int i = 0; i < N; i++)
        sum += matrix[i][j];

// Cache 友好的访问（按行访问）
for (int i = 0; i < N; i++)
    for (int j = 0; j < N; j++)
        sum += matrix[i][j];
```

**案例 2：数据对齐**
- 理解为什么结构体字段顺序影响性能
- 为什么 `malloc` 返回的地址是对齐的

**案例 3：分支预测**
- 理解为什么排序后的数组处理更快
- 避免不可预测的条件分支

## 🔧 与其他概念的联系

### 与操作系统
- **内存管理** - 虚拟内存由硬件和 OS 共同实现
- **进程调度** - CPU 核心分配
- **I/O 管理** - DMA 与中断机制

参考：`systems/operating-systems/`

### 与编译原理
- **寄存器分配** - 编译器优化
- **指令选择** - 代码生成
- **循环优化** - 利用流水线

### 与算法设计
- **Cache-aware 算法** - 考虑存储层次
- **并行算法** - 利用多核
- **数据布局** - 影响访问效率

参考：`fundamentals/algorithms/`

## 📖 推荐学习资源

### 经典教材
- *Computer Organization and Design* (Patterson & Hennessy) - RISC-V 版
- *Computer Architecture: A Quantitative Approach* - 进阶读物

### 实践项目
- NEMU（NJU Emulator）- 模拟器项目
- 实现简单的 RISC-V 处理器
- Cache 模拟器编写

### 在线资源
- Agner Fog's Optimization Manuals
- What Every Programmer Should Know About Memory
- Intel & AMD 优化手册

## 🎓 学习建议

1. **先理解概念再看实现** - 不要陷入技术细节
2. **动手实验** - 编写性能测试代码
3. **关联实际问题** - 思考如何优化你的代码
4. **循序渐进** - 从简单的冯·诺依曼架构开始

---

**开始探索计算机硬件的奥秘！** 🚀
