# Physical and Data Link Layers - ç‰©ç†å±‚ä¸æ•°æ®é“¾è·¯å±‚

> æ•°æ®å¦‚ä½•åœ¨ç‰©ç†ä»‹è´¨ä¸Šä¼ è¾“ï¼Ÿå¦‚ä½•ä¿è¯ä¼ è¾“çš„å¯é æ€§ï¼Ÿ

## ğŸ¯ ç‰©ç†å±‚ (Physical Layer)

### ç‰©ç†å±‚çš„ä½œç”¨

**ç‰©ç†å±‚**è´Ÿè´£åœ¨ç‰©ç†ä»‹è´¨ä¸Šä¼ è¾“åŸå§‹çš„æ¯”ç‰¹æµã€‚

```
åŠŸèƒ½ï¼š
- å®šä¹‰ç‰©ç†ç‰¹æ€§ï¼ˆç”µå‹ã€é¢‘ç‡ï¼‰
- å®šä¹‰æ¥å£æ ‡å‡†ï¼ˆç½‘çº¿æ¥å£ï¼‰
- ä¼ è¾“æ¯”ç‰¹æµï¼ˆ0å’Œ1ï¼‰

ç±»æ¯”ï¼š
ç‰©ç†å±‚ = å…¬è·¯
æ•°æ® = æ±½è½¦
```

---

## ğŸ”Œ ä¼ è¾“ä»‹è´¨

### 1. åŒç»çº¿ (Twisted Pair)

```
ç»“æ„ï¼šä¸¤æ ¹é“œçº¿ç»åœ¨ä¸€èµ·

åˆ†ç±»ï¼š
- UTPï¼ˆéå±è”½åŒç»çº¿ï¼‰ï¼šå¸¸è§çš„ç½‘çº¿
- STPï¼ˆå±è”½åŒç»çº¿ï¼‰ï¼šæŠ—å¹²æ‰°æ›´å¼º

ç±»åˆ«ï¼š
- Cat 5ï¼š100 Mbps
- Cat 5eï¼š1 Gbps
- Cat 6ï¼š10 Gbps
- Cat 7ï¼š10 Gbps+

ä¼˜ç‚¹ï¼šâœ… ä¾¿å®œ âœ… çµæ´» âœ… æ˜“å®‰è£…
ç¼ºç‚¹ï¼šâŒ è·ç¦»çŸ­ï¼ˆ100ç±³ï¼‰ âŒ æ˜“å—å¹²æ‰°
```

### 2. åŒè½´ç”µç¼† (Coaxial Cable)

```
ç»“æ„ï¼šä¸­å¿ƒå¯¼çº¿ + ç»ç¼˜å±‚ + å±è”½å±‚

ç‰¹ç‚¹ï¼š
- æŠ—å¹²æ‰°èƒ½åŠ›å¼º
- ä¼ è¾“è·ç¦»è¾ƒè¿œ

ç”¨é€”ï¼š
- æœ‰çº¿ç”µè§†
- æ—©æœŸä»¥å¤ªç½‘ï¼ˆå·²æ·˜æ±°ï¼‰

ä¼˜ç‚¹ï¼šâœ… æŠ—å¹²æ‰° âœ… å¸¦å®½é«˜
ç¼ºç‚¹ï¼šâŒ ç¡¬ âŒ è´µ
```

### 3. å…‰çº¤ (Optical Fiber)

```
åŸç†ï¼šå…‰çš„å…¨åå°„

åˆ†ç±»ï¼š
- å•æ¨¡å…‰çº¤ï¼šæ¿€å…‰ï¼Œè¿œè·ç¦»ï¼ˆå‡ åå…¬é‡Œï¼‰
- å¤šæ¨¡å…‰çº¤ï¼šLEDï¼ŒçŸ­è·ç¦»ï¼ˆå‡ å…¬é‡Œï¼‰

ç‰¹ç‚¹ï¼š
- å¸¦å®½æé«˜ï¼ˆTbpsï¼‰
- ä¼ è¾“è·ç¦»è¿œ
- ä¸å—ç”µç£å¹²æ‰°
- è½»ä¾¿

ä¼˜ç‚¹ï¼šâœ… é€Ÿåº¦å¿« âœ… è·ç¦»è¿œ âœ… ä¸å—å¹²æ‰°
ç¼ºç‚¹ï¼šâŒ è´µ âŒ å®‰è£…å¤æ‚
```

### 4. æ— çº¿ä¼ è¾“

```
åˆ†ç±»ï¼š
- æ— çº¿ç”µæ³¢ï¼šWi-Fiã€è“ç‰™
- å¾®æ³¢ï¼šå«æ˜Ÿé€šä¿¡
- çº¢å¤–çº¿ï¼šé¥æ§å™¨

Wi-Fiæ ‡å‡†ï¼š
- 802.11bï¼š11 Mbps
- 802.11gï¼š54 Mbps
- 802.11nï¼š600 Mbps
- 802.11acï¼š1-7 Gbps
- 802.11ax (Wi-Fi 6)ï¼š9.6 Gbps

ä¼˜ç‚¹ï¼šâœ… ç§»åŠ¨æ€§ âœ… çµæ´»
ç¼ºç‚¹ï¼šâŒ æ˜“å—å¹²æ‰° âŒ å®‰å…¨æ€§å·®
```

---

## ğŸ“¡ ç¼–ç ä¸è°ƒåˆ¶

### æ•°å­—ä¿¡å·ç¼–ç 

```python
def nrz_encoding(bits):
    """éå½’é›¶ç¼–ç  (NRZ)
    é«˜ç”µå¹³ = 1
    ä½ç”µå¹³ = 0
    """
    signal = []
    for bit in bits:
        signal.append(1 if bit == '1' else -1)
    return signal

def manchester_encoding(bits):
    """æ›¼å½»æ–¯ç‰¹ç¼–ç 
    ä¸Šè·³ = 0
    ä¸‹è·³ = 1

    ä¼˜ç‚¹ï¼šè‡ªå¸¦æ—¶é’Ÿä¿¡å·
    """
    signal = []
    for bit in bits:
        if bit == '0':
            signal.extend([1, -1])  # ä¸Šè·³
        else:
            signal.extend([-1, 1])  # ä¸‹è·³
    return signal

# ç¤ºä¾‹
bits = "1011"
print(f"åŸå§‹æ•°æ®: {bits}")
print(f"NRZç¼–ç : {nrz_encoding(bits)}")
print(f"æ›¼å½»æ–¯ç‰¹ç¼–ç : {manchester_encoding(bits)}")
```

---

## ğŸ”— æ•°æ®é“¾è·¯å±‚ (Data Link Layer)

### æ•°æ®é“¾è·¯å±‚çš„ä½œç”¨

```
åŠŸèƒ½ï¼š
1. æˆå¸§ï¼ˆFramingï¼‰ï¼šå°†æ¯”ç‰¹æµç»„ç»‡æˆå¸§
2. ç‰©ç†å¯»å€ï¼šMACåœ°å€
3. æµé‡æ§åˆ¶ï¼šé˜²æ­¢æ¥æ”¶æ–¹è¿‡è½½
4. é”™è¯¯æ§åˆ¶ï¼šæ£€æµ‹å’Œçº æ­£é”™è¯¯
5. è®¿é—®æ§åˆ¶ï¼šå¤šä¸ªè®¾å¤‡å…±äº«ä¿¡é“

æ•°æ®å•ä½ï¼šå¸§ï¼ˆFrameï¼‰
```

---

## ğŸ“¦ å¸§ç»“æ„

### ä»¥å¤ªç½‘å¸§æ ¼å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚å‰å¯¼ç    â”‚ç›®æ ‡MAC  â”‚æºMAC â”‚ç±»å‹    â”‚æ•°æ®  â”‚FCS  â”‚
â”‚8å­—èŠ‚    â”‚6å­—èŠ‚    â”‚6å­—èŠ‚ â”‚2å­—èŠ‚   â”‚46-   â”‚4å­—èŠ‚â”‚
â”‚         â”‚         â”‚      â”‚        â”‚1500  â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜

- å‰å¯¼ç ï¼šåŒæ­¥ç”¨
- ç›®æ ‡MACï¼šæ¥æ”¶æ–¹åœ°å€
- æºMACï¼šå‘é€æ–¹åœ°å€
- ç±»å‹ï¼šä¸Šå±‚åè®®ï¼ˆ0x0800=IPï¼‰
- æ•°æ®ï¼šæœ‰æ•ˆè½½è·
- FCSï¼šå¸§æ ¡éªŒåºåˆ—ï¼ˆCRCï¼‰
```

### Pythonæ¨¡æ‹Ÿä»¥å¤ªç½‘å¸§

```python
import struct
import binascii

class EthernetFrame:
    def __init__(self, dst_mac, src_mac, ether_type, data):
        self.dst_mac = dst_mac
        self.src_mac = src_mac
        self.ether_type = ether_type
        self.data = data

    @staticmethod
    def mac_to_bytes(mac_str):
        """MACåœ°å€è½¬å­—èŠ‚ï¼š'AA:BB:CC:DD:EE:FF' -> bytes"""
        return bytes.fromhex(mac_str.replace(':', ''))

    def calculate_crc(self, data):
        """è®¡ç®—CRCæ ¡éªŒ"""
        crc = binascii.crc32(data) & 0xFFFFFFFF
        return struct.pack('!I', crc)

    def build(self):
        """æ„å»ºä»¥å¤ªç½‘å¸§"""
        # å‰å¯¼ç ï¼ˆç®€åŒ–ï¼Œå®é™…æ˜¯ç¡¬ä»¶æ·»åŠ ï¼‰
        preamble = b'\xAA' * 7 + b'\xAB'

        # å¸§å¤´
        dst = self.mac_to_bytes(self.dst_mac)
        src = self.mac_to_bytes(self.src_mac)
        eth_type = struct.pack('!H', self.ether_type)

        # æ•°æ®ï¼ˆå¡«å……åˆ°æœ€å°46å­—èŠ‚ï¼‰
        data = self.data.encode() if isinstance(self.data, str) else self.data
        if len(data) < 46:
            data = data + b'\x00' * (46 - len(data))

        # è®¡ç®—FCS
        frame_without_fcs = dst + src + eth_type + data
        fcs = self.calculate_crc(frame_without_fcs)

        # å®Œæ•´å¸§
        frame = preamble + frame_without_fcs + fcs
        return frame

    def parse(frame_bytes):
        """è§£æä»¥å¤ªç½‘å¸§"""
        # è·³è¿‡å‰å¯¼ç 
        frame = frame_bytes[8:]

        dst_mac = ':'.join(f'{b:02X}' for b in frame[0:6])
        src_mac = ':'.join(f'{b:02X}' for b in frame[6:12])
        ether_type = struct.unpack('!H', frame[12:14])[0]
        data = frame[14:-4]  # å»æ‰FCS
        fcs = frame[-4:]

        return {
            'dst_mac': dst_mac,
            'src_mac': src_mac,
            'ether_type': hex(ether_type),
            'data': data,
            'fcs': fcs.hex()
        }

# ä½¿ç”¨
frame = EthernetFrame(
    dst_mac='11:22:33:44:55:66',
    src_mac='AA:BB:CC:DD:EE:FF',
    ether_type=0x0800,  # IPåè®®
    data='Hello, Ethernet!'
)

frame_bytes = frame.build()
print(f"å¸§å¤§å°: {len(frame_bytes)} å­—èŠ‚")
print(f"å¸§å†…å®¹: {frame_bytes[:50].hex()}...")

# è§£æ
parsed = EthernetFrame.parse(frame_bytes)
print(f"\nè§£æç»“æœ:")
print(f"ç›®æ ‡MAC: {parsed['dst_mac']}")
print(f"æºMAC: {parsed['src_mac']}")
print(f"ç±»å‹: {parsed['ether_type']}")
print(f"æ•°æ®: {parsed['data']}")
```

---

## ğŸ·ï¸ MACåœ°å€

### MACåœ°å€ç»“æ„

```
MACåœ°å€ï¼š48ä½ï¼ˆ6å­—èŠ‚ï¼‰

æ ¼å¼ï¼šAA:BB:CC:DD:EE:FF

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OUIï¼ˆ24ä½ï¼‰â”‚ NICï¼ˆ24ä½ï¼‰â”‚
â”‚  å‚å•†æ ‡è¯†   â”‚ ç½‘å¡ç¼–å·   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¾‹å­ï¼š
- 00:1A:2B:3C:4D:5E
  â””â”€ 00:1A:2B æ˜¯å‚å•†æ ‡è¯†ï¼ˆIntelï¼‰
     â””â”€ 3C:4D:5E æ˜¯ç½‘å¡ç¼–å·

ç‰¹æ®Šåœ°å€ï¼š
- FF:FF:FF:FF:FF:FFï¼šå¹¿æ’­åœ°å€
- 01:00:5E:XX:XX:XXï¼šå¤šæ’­åœ°å€
```

### æŸ¥çœ‹MACåœ°å€

```bash
# Linux/Mac
ifconfig
ip link show

# Windows
ipconfig /all

# PythonæŸ¥çœ‹MACåœ°å€
import uuid

def get_mac_address():
    mac = uuid.getnode()
    mac_str = ':'.join(('%012X' % mac)[i:i+2] for i in range(0, 12, 2))
    return mac_str

print(f"æœ¬æœºMACåœ°å€: {get_mac_address()}")
```

---

## ğŸ”„ ä»‹è´¨è®¿é—®æ§åˆ¶ (MAC)

### ä¿¡é“åˆ†é…

#### 1. é™æ€åˆ†é…

```
ä¿¡é“åˆ’åˆ†ï¼š
- FDMAï¼ˆé¢‘åˆ†å¤šå€ï¼‰ï¼šä¸åŒé¢‘ç‡
- TDMAï¼ˆæ—¶åˆ†å¤šå€ï¼‰ï¼šä¸åŒæ—¶é—´ç‰‡
- CDMAï¼ˆç åˆ†å¤šå€ï¼‰ï¼šä¸åŒç¼–ç 

ä¼˜ç‚¹ï¼šâœ… ç®€å• âœ… æ— å†²çª
ç¼ºç‚¹ï¼šâŒ æ•ˆç‡ä½ âŒ ä¸çµæ´»
```

#### 2. åŠ¨æ€åˆ†é…

```
éšæœºè®¿é—®ï¼š
- ALOHA
- CSMA/CDï¼ˆä»¥å¤ªç½‘ï¼‰
- CSMA/CAï¼ˆWi-Fiï¼‰
```

### CSMA/CDï¼ˆè½½æ³¢ä¾¦å¬å¤šè·¯è®¿é—®/å†²çªæ£€æµ‹ï¼‰

```
ä»¥å¤ªç½‘ä½¿ç”¨çš„åè®®

å·¥ä½œæµç¨‹ï¼š
1. è½½æ³¢ä¾¦å¬ï¼šæ£€æŸ¥ä¿¡é“æ˜¯å¦ç©ºé—²
2. å‘é€æ•°æ®ï¼šå¦‚æœç©ºé—²åˆ™å‘é€
3. å†²çªæ£€æµ‹ï¼šè¾¹å‘é€è¾¹ç›‘å¬
4. å†²çªå¤„ç†ï¼šæ£€æµ‹åˆ°å†²çªç«‹å³åœæ­¢
5. éšæœºé€€é¿ï¼šç­‰å¾…éšæœºæ—¶é—´åé‡è¯•
```

```python
import random
import time

class CSMACD:
    def __init__(self, max_attempts=16):
        self.max_attempts = max_attempts

    def sense_carrier(self):
        """è½½æ³¢ä¾¦å¬"""
        # æ¨¡æ‹Ÿæ£€æŸ¥ä¿¡é“
        return random.random() > 0.3  # 70%æ¦‚ç‡ç©ºé—²

    def detect_collision(self):
        """å†²çªæ£€æµ‹"""
        # æ¨¡æ‹Ÿæ£€æµ‹å†²çª
        return random.random() < 0.2  # 20%æ¦‚ç‡å†²çª

    def send_frame(self, frame_data):
        """å‘é€å¸§"""
        attempts = 0

        while attempts < self.max_attempts:
            print(f"å°è¯• {attempts + 1}:")

            # 1. è½½æ³¢ä¾¦å¬
            if not self.sense_carrier():
                print("  ä¿¡é“å¿™ï¼Œç­‰å¾…...")
                time.sleep(0.01)
                continue

            print("  ä¿¡é“ç©ºé—²ï¼Œå¼€å§‹å‘é€...")

            # 2. å‘é€æ•°æ®
            # 3. å†²çªæ£€æµ‹
            if self.detect_collision():
                print("  æ£€æµ‹åˆ°å†²çªï¼")
                attempts += 1

                # 4. éšæœºé€€é¿
                k = min(attempts, 10)
                backoff = random.randint(0, 2**k - 1)
                print(f"  é€€é¿æ—¶é—´: {backoff} æ—¶é—´ç‰‡")
                time.sleep(backoff * 0.01)
            else:
                print("  å‘é€æˆåŠŸï¼")
                return True

        print("è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œå‘é€å¤±è´¥")
        return False

# ä½¿ç”¨
csma = CSMACD()
csma.send_frame("Hello, Ethernet!")
```

### CSMA/CAï¼ˆç¢°æ’é¿å…ï¼‰

```
Wi-Fiä½¿ç”¨çš„åè®®

ä¸CSMA/CDçš„åŒºåˆ«ï¼š
- æ— çº¿ä¿¡å·æ— æ³•è¾¹å‘é€è¾¹æ£€æµ‹å†²çª
- ä½¿ç”¨RTS/CTSæ¡æ‰‹é¿å…å†²çª

å·¥ä½œæµç¨‹ï¼š
1. è½½æ³¢ä¾¦å¬
2. å‘é€RTSï¼ˆè¯·æ±‚å‘é€ï¼‰
3. æ¥æ”¶CTSï¼ˆå…è®¸å‘é€ï¼‰
4. å‘é€æ•°æ®
5. æ¥æ”¶ACKï¼ˆç¡®è®¤ï¼‰
```

---

## âŒ é”™è¯¯æ£€æµ‹

### 1. å¥‡å¶æ ¡éªŒ (Parity Check)

```python
def add_parity_bit(data, even=True):
    """æ·»åŠ å¥‡å¶æ ¡éªŒä½"""
    ones = data.count('1')

    if even:
        # å¶æ ¡éªŒï¼šä½¿1çš„ä¸ªæ•°ä¸ºå¶æ•°
        parity = '0' if ones % 2 == 0 else '1'
    else:
        # å¥‡æ ¡éªŒï¼šä½¿1çš„ä¸ªæ•°ä¸ºå¥‡æ•°
        parity = '1' if ones % 2 == 0 else '0'

    return data + parity

def check_parity(data_with_parity, even=True):
    """æ£€æŸ¥å¥‡å¶æ ¡éªŒ"""
    ones = data_with_parity.count('1')

    if even:
        return ones % 2 == 0
    else:
        return ones % 2 == 1

# ä½¿ç”¨
data = "1011010"
data_with_parity = add_parity_bit(data, even=True)
print(f"åŸå§‹æ•°æ®: {data}")
print(f"æ·»åŠ æ ¡éªŒä½: {data_with_parity}")

# æ£€æŸ¥ï¼ˆæ— é”™è¯¯ï¼‰
is_valid = check_parity(data_with_parity, even=True)
print(f"æ ¡éªŒç»“æœ: {'æ­£ç¡®' if is_valid else 'é”™è¯¯'}")

# æ¨¡æ‹Ÿé”™è¯¯
corrupted = data_with_parity[:-1] + ('0' if data_with_parity[-1] == '1' else '1')
is_valid = check_parity(corrupted, even=True)
print(f"æŸåæ•°æ®: {corrupted}")
print(f"æ ¡éªŒç»“æœ: {'æ­£ç¡®' if is_valid else 'é”™è¯¯'}")
```

### 2. CRCï¼ˆå¾ªç¯å†—ä½™æ ¡éªŒï¼‰

```python
def crc_remainder(data, polynomial):
    """è®¡ç®—CRCä½™æ•°"""
    # è½¬ä¸ºæ•´æ•°
    data_int = int(data, 2)
    poly_int = int(polynomial, 2)

    # å¤šé¡¹å¼çš„ä½æ•°
    poly_len = len(polynomial)

    # æ·»åŠ 0
    data_int <<= (poly_len - 1)

    # é™¤æ³•
    while data_int.bit_length() >= poly_len:
        shift = data_int.bit_length() - poly_len
        data_int ^= (poly_int << shift)

    # ä½™æ•°
    return format(data_int, f'0{poly_len-1}b')

def crc_encode(data, polynomial):
    """CRCç¼–ç """
    remainder = crc_remainder(data, polynomial)
    return data + remainder

def crc_check(encoded_data, polynomial):
    """CRCæ£€éªŒ"""
    remainder = crc_remainder(encoded_data, polynomial)
    return remainder == '0' * (len(polynomial) - 1)

# ä½¿ç”¨ï¼ˆCRC-4ï¼‰
data = "1101"
polynomial = "10011"  # x^4 + x + 1

encoded = crc_encode(data, polynomial)
print(f"åŸå§‹æ•°æ®: {data}")
print(f"å¤šé¡¹å¼: {polynomial}")
print(f"ç¼–ç å: {encoded}")

# æ£€éªŒ
is_valid = crc_check(encoded, polynomial)
print(f"æ ¡éªŒç»“æœ: {'æ­£ç¡®' if is_valid else 'é”™è¯¯'}")

# æ¨¡æ‹Ÿé”™è¯¯
corrupted = encoded[:3] + ('0' if encoded[3] == '1' else '1') + encoded[4:]
is_valid = crc_check(corrupted, polynomial)
print(f"æŸåæ•°æ®: {corrupted}")
print(f"æ ¡éªŒç»“æœ: {'æ­£ç¡®' if is_valid else 'é”™è¯¯'}")
```

---

## ğŸ”€ äº¤æ¢æœº (Switch)

### äº¤æ¢æœºçš„ä½œç”¨

```
åŠŸèƒ½ï¼š
- å·¥ä½œåœ¨æ•°æ®é“¾è·¯å±‚
- æ ¹æ®MACåœ°å€è½¬å‘å¸§
- å­¦ä¹ MACåœ°å€è¡¨
- éš”ç¦»å†²çªåŸŸ

vs é›†çº¿å™¨ï¼ˆHubï¼‰ï¼š
é›†çº¿å™¨ï¼šç‰©ç†å±‚è®¾å¤‡ï¼Œå¹¿æ’­åˆ°æ‰€æœ‰ç«¯å£
äº¤æ¢æœºï¼šé“¾è·¯å±‚è®¾å¤‡ï¼Œåªè½¬å‘åˆ°ç›®æ ‡ç«¯å£
```

### MACåœ°å€è¡¨å­¦ä¹ 

```python
class Switch:
    def __init__(self):
        self.mac_table = {}  # {MACåœ°å€: ç«¯å£å·}
        self.ports = {}      # {ç«¯å£å·: [è¿æ¥çš„è®¾å¤‡]}

    def learn_mac(self, mac_address, port):
        """å­¦ä¹ MACåœ°å€"""
        if mac_address not in self.mac_table:
            print(f"å­¦ä¹ : {mac_address} åœ¨ç«¯å£ {port}")
            self.mac_table[mac_address] = port
        elif self.mac_table[mac_address] != port:
            print(f"æ›´æ–°: {mac_address} ä»ç«¯å£ {self.mac_table[mac_address]} åˆ° {port}")
            self.mac_table[mac_address] = port

    def forward_frame(self, src_mac, dst_mac, src_port):
        """è½¬å‘å¸§"""
        # å­¦ä¹ æºMACåœ°å€
        self.learn_mac(src_mac, src_port)

        # æŸ¥æ‰¾ç›®æ ‡ç«¯å£
        if dst_mac == 'FF:FF:FF:FF:FF:FF':
            # å¹¿æ’­
            print(f"å¹¿æ’­å¸§: {src_mac} â†’ {dst_mac}")
            print(f"  ä»ç«¯å£ {src_port} å¹¿æ’­åˆ°æ‰€æœ‰å…¶ä»–ç«¯å£")
            return list(range(1, 5))  # å‡è®¾4ä¸ªç«¯å£

        if dst_mac in self.mac_table:
            # å·²çŸ¥ç›®æ ‡
            dst_port = self.mac_table[dst_mac]
            print(f"è½¬å‘å¸§: {src_mac} â†’ {dst_mac}")
            print(f"  ä»ç«¯å£ {src_port} åˆ°ç«¯å£ {dst_port}")
            return [dst_port]
        else:
            # æœªçŸ¥ç›®æ ‡ï¼Œæ³›æ´ª
            print(f"æœªçŸ¥ç›®æ ‡: {dst_mac}ï¼Œæ³›æ´ª")
            print(f"  ä»ç«¯å£ {src_port} æ³›æ´ªåˆ°æ‰€æœ‰å…¶ä»–ç«¯å£")
            return [p for p in range(1, 5) if p != src_port]

    def show_mac_table(self):
        """æ˜¾ç¤ºMACåœ°å€è¡¨"""
        print("\nMACåœ°å€è¡¨:")
        print("â”€" * 40)
        for mac, port in self.mac_table.items():
            print(f"{mac:20} â†’ ç«¯å£ {port}")
        print("â”€" * 40)

# ä½¿ç”¨
switch = Switch()

# æ¨¡æ‹Ÿå¸§è½¬å‘
print("=== å¸§1 ===")
switch.forward_frame('AA:BB:CC:DD:EE:01', 'AA:BB:CC:DD:EE:02', src_port=1)

print("\n=== å¸§2 ===")
switch.forward_frame('AA:BB:CC:DD:EE:02', 'AA:BB:CC:DD:EE:01', src_port=2)

print("\n=== å¸§3 ===")
switch.forward_frame('AA:BB:CC:DD:EE:01', 'AA:BB:CC:DD:EE:02', src_port=1)

print("\n=== å¸§4ï¼ˆå¹¿æ’­ï¼‰===")
switch.forward_frame('AA:BB:CC:DD:EE:01', 'FF:FF:FF:FF:FF:FF', src_port=1)

switch.show_mac_table()
```

---

## ğŸ”— ç›¸å…³æ¦‚å¿µ

- [ç½‘ç»œåŸºç¡€ä¸åˆ†å±‚æ¨¡å‹](network-fundamentals.md) - åˆ†å±‚æ¨¡å‹
- [ç½‘ç»œå±‚](network-layer.md) - IPåè®®

---

**è®°ä½**ï¼š
1. ç‰©ç†å±‚ä¼ è¾“æ¯”ç‰¹æµ
2. å¸¸è§ä¼ è¾“ä»‹è´¨ï¼šåŒç»çº¿ã€å…‰çº¤ã€æ— çº¿
3. æ•°æ®é“¾è·¯å±‚è´Ÿè´£æˆå¸§ã€å¯»å€ã€é”™è¯¯æ£€æµ‹
4. MACåœ°å€æ˜¯ç‰©ç†åœ°å€ï¼ˆ48ä½ï¼‰
5. ä»¥å¤ªç½‘ä½¿ç”¨CSMA/CDé¿å…å†²çª
6. CRCç”¨äºé”™è¯¯æ£€æµ‹
7. äº¤æ¢æœºå·¥ä½œåœ¨é“¾è·¯å±‚ï¼Œæ ¹æ®MACåœ°å€è½¬å‘
8. äº¤æ¢æœºé€šè¿‡å­¦ä¹ å»ºç«‹MACåœ°å€è¡¨
